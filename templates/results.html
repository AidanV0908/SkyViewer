<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/skyviewer.css') }}">
    <title>Satellite Observation Results</title>
    <style>
        /* General Layout */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            width: 100%;
            background-color: #f0f0f0;
        }
        h1 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 10px;
        }
        h5 {
            font-size: 1rem;
            margin-bottom: 3px;
        }
        label {
            font-size: 0.75rem;
            font-style:normal;
        }
        .description {
            text-align: center;
            color: #555;
            margin-bottom: 20px;
        }

        .hiddentime {
            display: flex;
        }

        /* Section Headers */
        .section-header {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 25px;
            margin-bottom: 10px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            color: #333;
        }

        /* Layout */
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .col-left {
            flex: 1 1 70%;
            order: 1;
        }
        .col-right {
            flex: 1 1 25%;
            order: 2;
        }

        /* Forms and Input Fields */
        .form-group {
            margin-bottom: 1em;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 0.3em;
        }
        input[type="text"], input[type="date"], input[type="time"], select {
            width: 100%;
            padding: 8px;
            font-size: 0.9rem;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input[type="color"] {
            width: 10%;
            aspect-ratio: 1 / 1;
            border: 1px solid #ccc;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }
        p {
            margin-bottom:8px;
        }
        /* Buttons */
        .btn {
            background-color: #007bff;
            color: white;
            padding: 8px 12px;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn:disabled {
            background-color: #5a6268;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .text-center {
            text-align: center;
        }
        .white-box {
            background-color: white;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 100%;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            margin: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .col-left, .col-right {
                flex: 1 1 100%;
                order: initial;
            }
        }
    </style>
</head>
<body>
    <input type="hidden" id="satId" value="{{satelliteId}}">
    <input type="hidden" id="epochdate" value="{{epochdate}}">
    <input type="hidden" id="epochtime" value="{{epochtime}}">
    <div style="width: 80%; margin-top: 20px; margin-bottom: 20px;">
        <!-- Title Section -->
        <h1>Results for {{satelliteName}}</h1>
        <div class="section-header">Description (AI Generated)</div>
        <p class="description">{{ai_exerpt}}</p>

        <!-- General Information Section -->
        <div class="section-header">General Information</div>
        <h5>TLE Data</h5>
        <div class="white-box">
            <p>{{satelliteName}}</p>
            <p>{{tle1}}</p>
            <p>{{tle2}}</p>
        </div>
        <h5>Basic</h5>
        <div style="padding-left:3%">  
        <p>ID: {{satelliteId}}</p>
        <p>Launch Year: {{launch_year}}</p>
        <p>Classification: {{classification}}</p>
        <p>Epoch: {{epochdate}} @ {{epochtime}} UTC</p>
        <p>Period: {{period}} hours</p>
        </div>

        <h5>Orbital Elements</h5>
        <div style="padding-left:3%">  
        <p>Semi-Major Axis: {{sma}} km</p>
        <p>Eccentricity: {{ecc}}</p>
        <p>Inclination: {{inc}} degrees</p>
        <p>Right Ascension of the Ascending Node: {{raan}} degrees</p>
        <p>Argument of Periapsis: {{argp}} degrees</p>
        <p>Mean Anomaly (Epoch): {{mean_anomaly}} degrees</p>
        </div>  

        <!-- Observation Information Section -->
        <div class="section-header">Observation Information</div>
        <p>To keep data meaningful, propagation is limited to {{maxprop}} days from epoch. <a href="/propagation-restrictions">Learn more.</a></p>

        <div class="form-group">
            <h5>Time Zone</h5>
            <p>Reference time zone, applied to all time fields on this page. Select the box to use system time. If no time is selected, system will default to UTC.</p>
            <p id="timezone-error" style="color:red; display:none;">Could not retrieve system time zone.</p>
            <div class="row">
                <label for="timezone">Time Zone:</label>
                <select id="timezone" onchange = "findNextPass()" style="width:20%">
                    <option value="">Select</option>
                </select>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="use-system-time" onclick="setSystemTimeZone()"> Use Current</label>
                </div>
            </div>
        </div>

        <h5>Reference Location</h5>
        <p>Enter a location, in terms of latitude and longitude, in degrees. Select the box to use your current location. If no value is selected, (0, 0) will be used by default. Please note this process could hang for a second, I am working on a fix for this.</p>
        <p id="latlong-error" style="color:red; display:none;">ERROR</p>
        <div class="row">
            <div class="form-group">
                <label for="latitude">Latitude:</label>
                <input type="text" id="latitude" onblur="validateLatLong()">
            </div>
            <div class="form-group">
                <label for="longitude">Longitude:</label>
                <input type="text" id="longitude" onblur="validateLatLong()">
            </div>
            <div class="checkbox-group">
                <label><input type="checkbox" id="use-current-location" onclick="setCurrentLocation()"> Use Current</label>
            </div>
        </div>

        <div class="section-header">Ground Track</div>
        <div class="row">
            <div class="col-right">
                <!-- Plot Info and Display Colors -->
                <h5>Settings</h5>
                <div class="form-group">
                    <label for="startAt">Start At:</label>
                    <p id="warningtxt" style="display: none; color:#ffd000; font-size:smaller; font-weight:bold;">Stale TLE: 'Current' option disabled</p>
                    <select id="startAt" onchange="updateOtherTimeField()">
                        <option value="epoch">Epoch</option>
                        <option value="current">Current</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="hiddentime" id="hiddentime">
                    <div class="form-group">
                        <label for="otherDate">Date:</label>
                        <input type="date" id="otherDate">
                    </div>
                    <div class="form-group">
                        <label for="otherTime">Time:</label>
                        <input type="time" id="otherTime">
                    </div>
                </div>
                <div class="form-group">
                    <!-- Labels for min, max, and current value -->
                    <label for="periods">Periods:</label>
                    <span id="min-value">1</span>
                    <input type="range" id="periods" min="1" max="10" value="1" oninput="updateSliderValue(this.value)">
                    <span id="max-value">10</span>
                    <span id="current-value" style="padding-left:5%; font-style:oblique; font-size:smaller"></span>    
                </div>
                <div class="form-group">
                    <label for="direction">Direction:</label>
                    <select id="direction">
                        <option value="forward">Forward</option>
                        <option value="backward">Backward</option>
                        <option value="bidirectional">Bidirectional</option>
                    </select>
                </div>

                <h5>Display Colors</h5>
                <div style="padding-left:5%">
                    <div class="form-group">
                        <label for="pathColor">Path</label>
                        <input type="color" id="pathColor" value="#0000ff">
                    </div>
                    <div class="form-group">
                        <label for="observerColor">Observer</label>
                        <input type="color" id="observerColor" value="#ff0000">
                    </div>
                    <div class="form-group">
                        <label for="refTimeColor">Reference Time</label>
                        <input type="color" id="refTimeColor" value="#00ff00">
                    </div>
                </div>
                <p style="font-style:italic; padding-bottom: 3px; display:none" id="loadText">Please hold, initializing data...</p>
                <button type="button" class="btn" id="generateButton" onclick="loadGroundTrack()" style="width:100%; margin-bottom: 10px;">Generate Plot</button>
                <button type="button" class="btn" id='saveButton' style="width:100%" disabled>Save Plot</button>
            </div>
            <div class="col-left">
                <!-- Ground Track Image -->
                <div id="plot" style="width: auto;"></div>
                <p style="font-style:italic; padding-top: 3px;" id="tipText">Tip: If nothing is here, click "Generate Plot"!</p>
            </div>
        </div>

        <!-- Next Pass Section -->
        <div id="nextPass">
            <div class="section-header">Next Pass</div>
            <p id="nextPassError" style="color:red; display:none;">ERROR</p>
            <div class="form-group">
                <label for="minElevation">Minimum Pass Elevation:</label>
                <input type="text" id="minElevation" style="width: 10%;" onblur="validateNextPass()"> degrees
            </div>
            <p id="nextPassText">Loading next passes...</p>
        </div>
        <!-- In Sun Section -->
        <div class="section-header">In Sun</div>
        <p id="sunErrorText" style="display:none; color:red">ERROR: Enter a date for sun analysis.</p>
        <div class="form-group">
            <label for="sunDate">Date:</label>
            <input type="date" id="sunDate">
        </div>
        <div class="form-group">
            <label for="sunTime">Time:</label>
            <input type="time" id="sunTime">
        </div>
        <p id="sunText" style="display:none; padding-top: 3px; padding-bottom: 15px;">On {sun_date} at {sun_time}, {satelliteName} will {in_or_out_of_sun}.</p>
        <div style="display: flex; justify-content: center; margin-top: 20px;">
            <button type="button" class="btn" id='sunButton' onclick="checkSunlit()" style="width:50%;">Submit</button>
        </div>
        <!-- Return Button -->
        <div class="text-center" style="margin-top: 20px;">
            <button type="button" id="returnButton" onclick="window.history.back()">Back</button>
        </div>
    </div>
</body>
<script src="{{ url_for('static',filename='javascript/results.js') }}"></script>
<script src="{{ url_for('static',filename='javascript/groundtrack.js') }}"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</html>
